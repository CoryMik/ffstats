<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025 Draft Recap</title>
  <style>
    :root{ --bg:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --accent:#22d3ee; --good:#22c55e; --bad:#f43f5e; --panel:rgba(255,255,255,.06); }
    html,body{margin:0;background:#0b1020;color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1000px;margin:36px auto;padding:0 18px 60px}
    header{padding:24px 18px;border:1px solid var(--panel);border-radius:16px;background:radial-gradient(800px 340px at 15% -10%, rgba(34,211,238,.22), transparent)}
    h1{margin:0 0 6px;font-size:28px;line-height:1.2}
    .sub{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:20px}
    @media (min-width:780px){.grid{grid-template-columns:1fr 1fr}}
    .card{border:1px solid var(--panel);border-radius:16px;padding:16px;background:linear-gradient(180deg,rgba(96,165,250,.05),transparent)}
    .head{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .head h2{font-size:18px;margin:0}
    .avatar{width:28px;height:28px;border-radius:50%;object-fit:cover;border:1px solid var(--panel)}
    .badge{margin-left:auto;border:1px solid var(--panel);border-radius:8px;padding:.15rem .5rem;font-weight:700}
    .badge.bad{color:var(--bad);border-color:rgba(244,63,94,.35);background:rgba(244,63,94,.1)}
    .badge.good{color:var(--good);border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.1)}
    .meta{display:flex;gap:10px;color:var(--muted);font-size:13px;margin:6px 0 10px;flex-wrap:wrap}
    .pill{border:1px solid var(--panel);border-radius:999px;padding:.1rem .5rem}
    .good{color:var(--good)}
    .bad{color:var(--bad)}
    .section-title{margin:28px 0 10px;font-size:18px;color:var(--accent)}
    .awards{display:grid;grid-template-columns:1fr;gap:10px}
    @media (min-width:780px){.awards{grid-template-columns:1fr 1fr}}
    .award{border:1px solid var(--panel);border-radius:12px;padding:12px;background:linear-gradient(180deg,rgba(34,211,238,.06),transparent)}
    .index{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}
    .index a{border:1px solid var(--panel);border-radius:999px;padding:.25rem .6rem;color:#60a5fa;text-decoration:none}
    .index a:hover{text-decoration:underline}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1 id="leagueTitle">üèà Draft Recap & Report Cards</h1>
    <div class="sub">Powered by AI</div>
    <nav class="index" id="indexNav"></nav>
  </header>

  <section class="grid" id="cards"></section>

  <h3 class="section-title">üìä League Superlatives</h3>
  <div class="awards" id="awards"></div>

  <footer>
    <p class="small">Tip: Press ‚åò/Ctrl + P to print or ‚ÄúSave as PDF‚Äù. If opening locally, serve via a simple HTTP server (e.g., <code>python -m http.server</code>).</p>
  </footer>
</div>

<script>
  const queryString = window.location.search;
  const urlParams = new URLSearchParams(queryString);
  const leagueId = urlParams.get('league') || '1242919056370040832'; // "John"
  async function loadData() {

    const res = await fetch('league_data_'+ leagueId  +'.json', {cache:'no-store'});
    if (!res.ok) throw new Error('Failed to load JSON');
    return await res.json();
  }

  function gradeClass(grade) {
    const letter = (grade||'B').charAt(0);
    return ['A'].includes(letter) ? 'badge good' : (['D','F','C'].includes(letter) ? 'badge bad' : 'badge');
  }
  function poopLabel(count) { return (!count) ? 'No poops received' : 'üí© x' + count; }

  function render(league) {
    const title = document.getElementById('leagueTitle');
    title.textContent = `üèà ${league.season} ${league.league_name} ‚Äî Draft Recap & Report Cards`;

    const cards = document.getElementById('cards');
    const nav = document.getElementById('indexNav');
    const awards = document.getElementById('awards');
    const totalPoops = league.teams.reduce((sum, team) => sum + team.poop_count, 0);

    league.teams.sort((a,b) => a.team_name.localeCompare(b.team_name));

    league.teams.forEach(t => {
      const a = document.createElement('a');
      const id = t.display_name.toLowerCase().replace(/[^a-z0-9]+/g,'-');
      a.href = '#' + id;
      a.textContent = t.team_name;
      nav.appendChild(a);
    });

    league.teams.forEach(t => {
      const id = t.display_name.toLowerCase().replace(/[^a-z0-9]+/g,'-');

      const card = document.createElement('article');
      card.className = 'card';
      card.id = id;

      const head = document.createElement('div');
      head.className = 'head';

      const img = document.createElement('img');
      img.className = 'avatar';
      img.src = t.avatar_url;
      img.alt = 'avatar';

      const h2 = document.createElement('h2');
      h2.textContent = `${t.team_name} (${t.display_name})`;

      const grade = document.createElement('span');
      grade.className = gradeClass(t.grade);
      grade.textContent = t.grade;

      head.appendChild(img);
      head.appendChild(h2);
      head.appendChild(grade);

      const meta = document.createElement('div');
      meta.className = 'meta';
      const pill1 = document.createElement('span');
      pill1.className = 'pill';
      pill1.textContent = `Team name creativity ${t.creativity_score}/10`;
      meta.appendChild(pill1);

      if(totalPoops > 0){
        const pill2 = document.createElement('span');
        pill2.className = 'pill';
        pill2.textContent = poopLabel(t.poop_count);
        meta.appendChild(pill2);
      }

      const good = document.createElement('p');
      good.className = 'good';
      good.innerHTML = '<strong>The Good:</strong> ' + (t.blurb_good||'');

      const bad = document.createElement('p');
      bad.className = 'bad';
      bad.innerHTML = '<strong>The Bad:</strong> ' + (t.blurb_bad||'');

      card.appendChild(head);
      card.appendChild(meta);
      card.appendChild(good);
      card.appendChild(bad);

      if (t.poop_events && t.poop_events.length) {
        const list = document.createElement('p');
        list.className = 'small';
        list.textContent = 'Poop events: ' + t.poop_events.map(e => `${e.player} (R${e.round}: üí©x${e.poops})`).join('; ');
        card.appendChild(list);
      }

      cards.appendChild(card);
    });

    const idmap = Object.fromEntries(league.teams.map(t => [t.user_id, t.team_name]));
    function names(ids){ return (ids||[]).map(i => idmap[i]||i).join(', ')}
    function name(id){return idmap[id]}

    const aw = [];
    aw.push(
            ['Best Draft', idmap[league.superlatives.best_draft.team_id] + " - " + league.superlatives.best_draft.info],
            ['Shakiest Draft', idmap[league.superlatives.shakiest_draft.team_id] + " - " + league.superlatives.shakiest_draft.info],
            ['Best Team Name', names(league.superlatives.best_team_name)]
    );
    if (league.superlatives.most_poops && league.superlatives.most_poops.length > 0) {
      aw.push(['Most Poops Award', names(league.superlatives.most_poops)]);
    }
    aw.forEach(([label, val]) => {
      const div = document.createElement('div');
      div.className = 'award';
      div.innerHTML = `<strong>${label}:</strong> <em>${val}</em>`;
      awards.appendChild(div);
    });
  }

  loadData().then(render).catch(err => {
    console.error(err);
    const p = document.createElement('p');
    p.textContent = 'Failed to load league_data.json. If viewing locally, start a simple HTTP server.';
    document.body.appendChild(p);
  });
</script>
</body>
</html>
